<!doctype html>
<html lang="kr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>IGDB TEST WEB (made by.MH)</title>
    <!-- 제이쿼리 -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
</head>
<body>
<div class="accordion" id="accordionExample" style="width : 500px; margin-left : 20px;">
    <div class="accordion-item">
        <h2 class="accordion-header" id="headingOne">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                점심 뭐먹지 패치노트
            </button>
        </h2>
        <div id="collapseOne" class="accordion-collapse collapse" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
            <div class="accordion-body">
                <p><strong>2023.03.19 V1.0 테스트 데이터 10개</strong></p>
            </div>
        </div>
    </div>
    <a href="/"><strong>뒤로 가기</strong></a>
</div>
<div style="margin:50px; width:1900px; display: flex;">
    <div id="positions">
        {{#positions}}
            <input type="hidden" name="content" value="{{content}}">
            <input type="hidden" name="X" value="{{X}}">
            <input type="hidden" name="Y" value="{{Y}}">
            <input type="hidden" name="id" value="{{id}}">
        {{/positions}}
    </div>
    <div id="map" style="width:1000px;height:800px;"></div>
    <div>
        <table class="table" style="margin-left:20px; width:800px;">
            <thead>
            <tr>
                <th scope="col">#</th>
                <th scope="col">이름</th>
                <th scope="col">구분</th>
                <th scope="col">대표메뉴</th>
                <th scope="col">버튼</th>
            </tr>
            </thead>
            <tbody>
            {{#data}}
                <tr>
                    <th scope="row">{{id}}</th>
                    <td>{{name}}</td>
                    <td>{{category}}</td>
                    <td>{{menu}}</td>
                    <td><input type="button" id="{{id}}" value="위치보기"></td>
                </tr>
            {{/data}}
            </tbody>
        </table>
    </div>
</div>

<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=1f3c36353159681ee258a746648ee5f2&libraries=services"></script>
<script type="text/javascript">
    var y = 37.4003521;
    var x = 127.1107886;
    var mapContainer = document.getElementById('map'), // 지도를 표시할 div
    mapOption = {
        center: new kakao.maps.LatLng(y, x), // 지도의 중심좌표
        level: 4 // 지도의 확대 레벨
    };

    var map = new kakao.maps.Map(mapContainer, mapOption); // 지도를 생성합니다

    var positions = [];
    var contents = document.getElementsByName("content");
    var X = document.getElementsByName("X");
    var Y = document.getElementsByName("Y");
    var ids = document.getElementsByName("id");
    for(var i=0; i<ids.length; i++) {
        var position = {};
        position.content = contents[i].value;
        position.latlng = new kakao.maps.LatLng(Y[i].value, X[i].value);
        position.id = ids[i].value;
        positions.push(position);
    }

    var infowindows = [];

    for (var i = 0; i < positions.length; i ++) {
        var marker = new kakao.maps.Marker({
            map: map,
            position: positions[i].latlng
        });

        var infowindow = new kakao.maps.InfoWindow({
            content: positions[i].content,
        });

        var element = document.getElementById(positions[i].id);
        element.addEventListener("click", makeBtnEvent(map, marker, infowindow));
    }

    function makeBtnEvent(map, marker, infowindow) {
        return function() {
            if(infowindows.length > 0) {
                infowindows[0].close();
            }
            infowindows[0]= infowindow;
            infowindows[0].open(map, marker);
        };
    }

</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
</body>
</html>